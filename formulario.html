<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">Carregando...</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f0f2f5; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .container { background-color: #ffffff; padding: 30px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); width: 100%; max-width: 400px; box-sizing: border-box; }
        h1 { text-align: center; color: #333; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; color: #555; font-weight: bold; }
        input[type="text"], input[type="email"], input[type="tel"], select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 16px; }
        button { width: 100%; padding: 12px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; font-size: 18px; cursor: pointer; transition: background-color 0.3s; }
        button:hover { background-color: #45a049; }
        #loading { text-align: center; display: none; margin-top: 10px; color: #555; }
    </style>
</head>
<body>
<div class="container">
    <h1 id="formTitle">Carregando...</h1>
    <form id="cadastroForm">
        <div class="form-group">
            <label for="nome">Nome Completo:</label>
            <input type="text" id="nome" name="nome" required>
        </div>
        <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" required>
        </div>
        <div class="form-group">
            <label for="pais">País:</label>
            <select id="pais" name="pais" required>
                <option value="">Selecione um país</option>
            </select>
        </div>
        <div class="form-group">
            <label for="telefone">Telefone Celular:</label>
            <input type="tel" id="telefone" name="telefone" required>
        </div>
        <button type="submit">Cadastrar</button>
        <p id="loading" style="display: none;">Enviando...</p>
    </form>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/imask/6.0.7/imask.min.js"></script>
<script>
    const appScriptURL = 'https://script.google.com/macros/s/AKfycbzsGIJKF40hxF7eTqQ0E6Bats5XcLsL2OEf9b1DMFM8YFs3-61WIHEjbuFRn4oarglOiA/exec';

    const paises = {
        'Anguila': '+1', 'Antígua e Barbuda': '+1', 'Bahamas': '+1', 'Barbados': '+1', 'Bermudas': '+1', 'Canadá': '+1', 'Dominica': '+1', 'Estados Unidos': '+1', 'Granada': '+1', 'Guam': '+1', 'Ilhas Caimã': '+1', 'Ilhas Marianas do Norte': '+1', 'Ilhas Virgens Americanas': '+1', 'Ilhas Virgens Britânicas': '+1', 'Jamaica': '+1', 'Monserrate': '+1', 'Porto Rico': '+1', 'República Dominicana': '+1', 'Samoa Americana': '+1', 'Santa Lúcia': '+1', 'São Cristóvão e Neves': '+1', 'São Martinho': '+1', 'São Vicente e Granadinas': '+1', 'Trindade e Tobago': '+1', 'Turcas e Caicos': '+1', 'Egipto': '+20', 'Sudão do Sul': '+211', 'Marrocos': '+212', 'Saara Ocidental': '+212', 'Argélia': '+213', 'Tunísia': '+216', 'Líbia': '+218', 'Gâmbia': '+220', 'Senegal': '+221', 'Mauritânia': '+222', 'Mali': '+223', 'Guiné': '+224', 'Costa do Marfim': '+225', 'Burquina Fasso': '+226', 'Níger': '+227', 'Togo': '+228', 'Benim': '+229', 'Maurícia': '+230', 'Libéria': '+231', 'Serra Leoa': '+232', 'Gana': '+233', 'Nigéria': '+234', 'Chade': '+235', 'República Centro-Africana': '+236', 'Camarões': '+237', 'Cabo Verde': '+238', 'São Tomé e Príncipe': '+239', 'Guiné Equatorial': '+240', 'Gabão': '+241', 'Congo-Brazavile': '+242', 'Congo-Quinxassa': '+243', 'Angola': '+244', 'Guiné-Bissau': '+245', 'Território Britânico do Oceano Índico': '+246', 'Ascensão': '+247', 'Seicheles': '+248', 'Sudão': '+249', 'Ruanda': '+250', 'Etiópia': '+251', 'Somália': '+252', 'Djibuti': '+253', 'Quênia': '+254', 'Tanzânia': '+255', 'Uganda': '+256', 'Burundi': '+257', 'Moçambique': '+258', 'Zâmbia': '+260', 'Madagascar': '+261', 'Maiote': '+262', 'Reunião': '+262', 'Zimbábue': '+263', 'Namíbia': '+264', 'Maláui': '+265', 'Lesoto': '+266', 'Botsuana': '+267', 'Essuatíni': '+268', 'Comores': '+269', 'África do Sul': '+27', 'Santa Helena': '+290', 'Tristão da Cunha': '+290', 'Eritreia': '+291', 'Aruba': '+297', 'Ilhas Féroe': '+298', 'Groenlândia': '+299', 'Grécia': '+30', 'Países Baixos': '+31', 'Bélgica': '+32', 'França': '+33', 'Espanha': '+34', 'Gibraltar': '+350', 'Portugal': '+351', 'Luxemburgo': '+352', 'Irlanda': '+353', 'Islândia': '+354', 'Albânia': '+355', 'Malta': '+356', 'Chipre': '+357', 'Finlândia': '+358', 'Bulgária': '+359', 'Hungria': '+36', 'Lituânia': '+370', 'Letônia': '+371', 'Estónia': '+372', 'Moldávia': '+373', 'Armênia': '+374', 'Bielorrússia': '+375', 'Andorra': '+376', 'Mônaco': '+377', 'São Marinho': '+378', 'Vaticano': '+379', 'Ucrânia': '+380', 'Sérvia': '+381', 'Montenegro': '+382', 'Kosovo': '+383', 'Croácia': '+385', 'Eslovénia': '+386', 'Bósnia e Herzegovina': '+387', 'Macedônia do Norte': '+389', 'Itália': '+39', 'Romênia': '+40', 'Suíça': '+41', 'Tchéquia': '+420', 'Eslováquia': '+421', 'Liechtenstein': '+423', 'Áustria': '+43', 'Reino Unido': '+44', 'Dinamarca': '+45', 'Suécia': '+46', 'Noruega': '+47', 'Polônia': '+48', 'Alemanha': '+49', 'Ilhas Malvinas': '+500', 'Ilhas Geórgia do Sul e Sandwich do Sul': '+500', 'Belize': '+501', 'Guatemala': '+502', 'El Salvador': '+503', 'Honduras': '+504', 'Nicarágua': '+505', 'Costa Rica': '+506', 'Panamá': '+507', 'São Pedro e Miquelão': '+508', 'Haiti': '+509', 'Peru': '+51', 'México': '+52', 'Cuba': '+53', 'Argentina': '+54', 'Brasil': '+55', 'Chile': '+56', 'Colômbia': '+57', 'Venezuela': '+58', 'Guadalupe': '+590', 'São Bartolomeu': '+590', 'São Martinho': '+590', 'Bolívia': '+591', 'Guiana': '+592', 'Equador': '+593', 'Guiana Francesa': '+594', 'Paraguai': '+595', 'Martinica': '+596', 'Suriname': '+597', 'Uruguai': '+598', 'Bonaire': '+599', 'Curaçao': '+599', 'Saba': '+599', 'Santo Eustáquio': '+599', 'Malásia': '+60', 'Austrália': '+61', 'Ilha Christmas': '+61', 'Ilhas Cocos': '+61', 'Indonésia': '+62', 'Filipinas': '+63', 'Nova Zelândia': '+64', 'Ilhas Pitcairn': '+64', 'Singapura': '+65', 'Tailândia': '+66', 'Timor-Leste': '+670', 'Ilha Norfolque': '+672', 'Território Antártico Australiano': '+672', 'Brunei': '+673', 'Nauru': '+674', 'Papua-Nova Guiné': '+675', 'Tonga': '+676', 'Ilhas Salomão': '+677', 'Vanuatu': '+678', 'Fiji': '+679', 'Palau': '+680', 'Wallis e Futuna': '+681', 'Ilhas Cook': '+682', 'Niue': '+683', 'Samoa': '+685', 'Quiribáti': '+686', 'Nova Caledônia': '+687', 'Tuvalu': '+688', 'Polinésia Francesa': '+689', 'Toquelau': '+690', 'Estados Federados da Micronésia': '+691', 'Ilhas Marshall': '+692', 'Cazaquistão': '+7', 'Rússia': '+7', 'Japão': '+81', 'Coreia do Sul': '+82', 'Vietnã': '+84', 'Coreia do Norte': '+850', 'Hong Kong': '+852', 'Macau': '+853', 'Camboja': '+855', 'Laos': '+856', 'China': '+86', 'Bangladexe': '+880', 'Taiwan': '+886', 'Turquia': '+90', 'Índia': '+91', 'Paquistão': '+92', 'Afeganistão': '+93', 'Seri Lanca': '+94', 'Mianmar': '+95', 'Maldivas': '+960', 'Líbano': '+961', 'Jordânia': '+962', 'Síria': '+963', 'Iraque': '+964', 'Kuwait': '+965', 'Arábia Saudita': '+966', 'Iêmen': '+967', 'Omã': '+968', 'Palestina': '+970', 'Emirados Árabes Unidos': '+971', 'Israel': '+972', 'Barém': '+973', 'Catar': '+974', 'Butão': '+975', 'Mongólia': '+976', 'Nepal': '+977', 'Irã': '+98', 'Tajiquistão': '+992', 'Turcomenistão': '+993', 'Azerbaijão': '+994', 'Geórgia': '+995', 'Quirguistão': '+996', 'Uzbequistão': '+998'
    };
    
    // Adiciona as opções de países ao campo de seleção
    const paisSelect = document.getElementById('pais');
    for (const [pais, codigo] of Object.entries(paises).sort()) {
        const option = document.createElement('option');
        option.value = codigo;
        option.textContent = pais; // Apenas o nome do país
        paisSelect.appendChild(option);
    }

    const telefoneInput = document.getElementById('telefone');
    let phoneMask = null;

    // Remove as máscaras do IMask
    const maskOptions = {
        'Brasil': { mask: '(00) 00 00000-0000', placeholder: '(+55) __ _____-____' },
        'Estados Unidos': { mask: '(000) 000-0000', placeholder: '(+1) ___ ___-____' },
        'Canadá': { mask: '(000) 000-0000', placeholder: '(+1) ___ ___-____' },
        'Portugal': { mask: '000 000 000', placeholder: '(+351) ___ ___ ___' },
        'França': { mask: '0 00 00 00 00', placeholder: '(+33) _ __ __ __ __' },
        'Reino Unido': { mask: '0000 000 000', placeholder: '(+44) ____ ___ ___' }
    };

    paisSelect.addEventListener('change', function() {
        const nomePais = this.options[this.selectedIndex].text;
        const codigo = this.value;
        
        if (phoneMask) {
            phoneMask.destroy();
        }

        // Adiciona o código do país ao valor do campo
        telefoneInput.value = codigo;

        if (nomePais && maskOptions[nomePais]) {
            telefoneInput.placeholder = maskOptions[nomePais].placeholder;
            phoneMask = IMask(telefoneInput, { mask: maskOptions[nomePais].mask, lazy: false });
        } else {
            telefoneInput.placeholder = '';
            phoneMask = null;
        }
    });

    function loadConfig() {
        fetch(appScriptURL)
            .then(response => response.json())
            .then(config => {
                document.getElementById('pageTitle').textContent = config.title;
                document.getElementById('formTitle').textContent = config.title;
            })
            .catch(error => {
                console.error('Erro ao carregar as configurações:', error);
                document.getElementById('formTitle').textContent = 'Erro ao carregar o formulário.';
            });
    }

    window.onload = loadConfig;

    document.getElementById('cadastroForm').addEventListener('submit', function(event) {
        event.preventDefault();
        const form = event.target;
        const formData = new FormData(form);
        const data = new URLSearchParams(formData);
        const loadingText = document.getElementById('loading');
        loadingText.style.display = 'block';

        fetch(appScriptURL, {
            method: 'POST',
            body: data
        })
        .then(response => response.json())
        .then(result => {
            if (result.result === 'success') {
                window.location.href = 'confirmacao.html?link=' + encodeURIComponent(result.whatsappLink);
            } else {
                loadingText.textContent = 'Erro ao enviar dados. Tente novamente.';
                loadingText.style.color = 'red';
            }
        })
        .catch(error => {
            loadingText.textContent = 'Erro de conexão. Tente novamente.';
            loadingText.style.color = 'red';
        });
    });
</script>
