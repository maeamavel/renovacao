<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">Carregando...</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f7f9fc;
            background-image: linear-gradient(to right top, #e0f7fa, #f7f9fc);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        .container {
            background-color: #ffffff;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.07);
            width: 100%;
            max-width: 550px;
            box-sizing: border-box;
        }
        .header-image {
            width: 100%;
            height: auto;
            display: block;
            margin-bottom: 25px;
            border-radius: 8px;
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            font-weight: 600;
            margin-bottom: 15px;
        }
        .observacao {
            text-align: center;
            color: #555;
            margin-bottom: 30px;
            font-size: 0.95em;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }
        .input-wrapper i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #adb5bd;
            transition: color 0.3s;
        }
        label {
            display: block;
            margin-bottom: 8px;
            color: #34495e;
            font-weight: 500;
            font-size: 0.9em;
        }
        input[type="text"], input[type="email"], input[type="tel"], select {
            width: 100%;
            padding: 12px 15px 12px 45px;
            border: 1px solid #dfe6e9;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 16px;
            font-family: 'Poppins', sans-serif;
            transition: border-color 0.3s, box-shadow 0.3s;
            line-height: normal;
        }
        input[type="text"]:focus, input[type="email"]:focus, input[type="tel"]:focus, select:focus {
            outline: none;
            border-color: #27ae60;
            box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.1);
        }
        input[type="text"]:focus ~ i, input[type="email"]:focus ~ i, input[type="tel"]:focus ~ i, select:focus ~ i {
            color: #27ae60;
        }
        .consentimento {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .consentimento input {
            width: auto;
            padding-left: 0; /* Remover padding para radio buttons */
        }
        .consentimento label {
            font-weight: 400;
            font-size: 0.9em;
        }
        button {
            width: 100%;
            padding: 14px;
            background-color: #27ae60;
            background-image: linear-gradient(to right, #27ae60, #2ecc71);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            font-family: 'Poppins', sans-serif;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 15px rgba(46, 204, 113, 0.3);
        }
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 20px rgba(46, 204, 113, 0.4);
        }
        #loading {
            text-align: center;
            display: none;
            margin-top: 10px;
            color: #555;
        }
        .validation-message {
            color: #e74c3c;
            font-size: 0.9em;
            margin-top: 5px;
        }
        .info-text {
            text-align: center;
            color: #666;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 0.85em;
        }
        .video-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* Propor√ß√£o 16:9 */
            height: 0;
            overflow: hidden;
            margin-top: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
<div class="container">
    <img id="headerImage" class="header-image" src="" alt="Imagem de cabe√ßalho">
    <h1 id="formTitle">Carregando...</h1>
    <p id="observacao" class="observacao"></p>
    <form id="cadastroForm">
        <div class="form-group">
            <label for="nome">Nome Completo:</label>
            <div class="input-wrapper">
                <input type="text" id="nome" name="nome" required>
                <i class="fa-solid fa-user"></i>
            </div>
        </div>
        <div class="form-group">
            <label for="email">Email:</label>
            <div class="input-wrapper">
                <input type="email" id="email" name="email" required>
                <i class="fa-solid fa-envelope"></i>
            </div>
        </div>
	<div class="form-group">
            <label for="pais">Pa√≠s:</label>
            <div class="input-wrapper">
                <select id="pais" name="pais" required>
                    <option value="">Selecione um pa√≠s</option>
                </select>
                <i class="fa-solid fa-flag"></i>
            </div>
        </div>
        <div class="form-group">
            <label for="estado">Em qual estado/distrito voc√™ mora?</label>
            <div class="input-wrapper" id="estado-wrapper">
                <input type="text" id="estado" name="estado" required>
                <i class="fa-solid fa-map-location-dot"></i>
            </div>
        </div>
        <div class="form-group">
            <label for="cidade">Cidade:</label>
            <div class="input-wrapper">
                <input type="text" id="cidade" name="cidade" required>
                <i class="fa-solid fa-city"></i>
            </div>
        </div>
        <div class="form-group">
            <label for="telefone">Telefone/Whatsapp:</label>
            <div class="input-wrapper">
                <input type="tel" id="telefone" name="telefone" required>
                <i class="fa-solid fa-phone"></i>
            </div>
            <div id="telefoneValidation" class="validation-message" style="display: none;"></div>
        </div>
        <div class="form-group">
            <label>Voc√™ j√° fez a Consagra√ß√£o Total a Nossa Senhora?</label>
            <div class="consentimento">
                <input type="radio" id="consagracao_sim" name="anoConsagracao" value="Sim" required>
                <label for="consagracao_sim">Sim</label>
                <input type="radio" id="consagracao_nao" name="anoConsagracao" value="N√£o" required>
                <label for="consagracao_nao">N√£o</label>
            </div>
        </div>
        <div class="form-group">
            <label>Confirma seu interesse em fazer o Retiro?</label>
            <div class="consentimento">
                <input type="radio" id="consentimento_sim" name="consentimento" value="Sim" required>
                <label for="consentimento_sim">Sim</label>
                <input type="radio" id="consentimento_nao" name="consentimento" value="N√£o" required>
                <label for="consentimento_nao">N√£o</label>
            </div>
        </div>
        <p style="text-align: center; margin-top: 30px;">ASSISTA AO V√çDEO PARA SABER OS PR√ìXIMOS PASSOS:</p>
        <div class="video-container">
            <iframe width="560" height="315" src="COLE_O_LINK_DO_SEU_VIDEO_AQUI" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
        <p class="info-text">üëâ Clique em "CADASTRAR" e entre no grupo de WhatsApp para participar do retiro.</p>
        <button type="submit">Cadastrar</button>
        <p id="loading" style="display: none;">Enviando...</p>
    </form>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/imask/6.0.7/imask.min.js"></script>
<script>
    const appScriptURL = 'https://script.google.com/macros/s/AKfycbz--eN0YF9kpr5xXrOGc15R6qVf-NFBm2YXdiqZrMVryNCIPFFns2bzfzq7S2Pdsvo4aw/exec';

    const paises = {
        'Anguila': '+1', 'Ant√≠gua e Barbuda': '+1', 'Bahamas': '+1', 'Barbados': '+1', 'Bermudas': '+1', 'Canad√°': '+1', 'Dominica': '+1', 'Estados Unidos': '+1', 'Granada': '+1', 'Guam': '+1', 'Ilhas Caim√£': '+1', 'Ilhas Marianas do Norte': '+1', 'Ilhas Virgens Americanas': '+1', 'Ilhas Virgens Brit√¢nicas': '+1', 'Jamaica': '+1', 'Monserrate': '+1', 'Porto Rico': '+1', 'Rep√∫blica Dominicana': '+1', 'Samoa Americana': '+1', 'Santa L√∫cia': '+1', 'S√£o Crist√≥v√£o e Neves': '+1', 'S√£o Martinho': '+1', 'S√£o Vicente e Granadinas': '+1', 'Trindade e Tobago': '+1', 'Turcas e Caicos': '+1', 'Egipto': '+20', 'Sud√£o do Sul': '+211', 'Marrocos': '+212', 'Saara Ocidental': '+212', 'Arg√©lia': '+213', 'Tun√≠sia': '+216', 'L√≠bia': '+218', 'G√¢mbia': '+220', 'Senegal': '+221', 'Maurit√¢nia': '+222', 'Mali': '+223', 'Guin√©': '+224', 'Costa do Marfim': '+225', 'Burquina Fasso': '+226', 'N√≠ger': '+227', 'Togo': '+228', 'Benim': '+229', 'Maur√≠cia': '+230', 'Lib√©ria': '+231', 'Serra Leoa': '+232', 'Gana': '+233', 'Nig√©ria': '+234', 'Chade': '+235', 'Rep√∫blica Centro-Africana': '+236', 'Camar√µes': '+237', 'Cabo Verde': '+238', 'S√£o Tom√© e Pr√≠ncipe': '+239', 'Guin√© Equatorial': '+240', 'Gab√£o': '+241', 'Congo-Brazavile': '+242', 'Congo-Quinxassa': '+243', 'Angola': '+244', 'Guin√©-Bissau': '+245', 'Territ√≥rio Brit√¢nico do Oceano √çndico': '+246', 'Ascens√£o': '+247', 'Seicheles': '+248', 'Sud√£o': '+249', 'Ruanda': '+250', 'Eti√≥pia': '+251', 'Som√°lia': '+252', 'Djibuti': '+253', 'Qu√™nia': '+254', 'Tanz√¢nia': '+255', 'Uganda': '+256', 'Burundi': '+257', 'Mo√ßambique': '+258', 'Z√¢mbia': '+260', 'Madagascar': '+261', 'Maiote': '+262', 'Reuni√£o': '+262', 'Zimb√°bue': '+263', 'Nam√≠bia': '+264', 'Mal√°ui': '+265', 'Lesoto': '+266', 'Botsuana': '+267', 'Essuat√≠ni': '+268', 'Comores': '+269', '√Åfrica do Sul': '+27', 'Santa Helena': '+290', 'Trist√£o da Cunha': '+290', 'Eritreia': '+291', 'Aruba': '+297', 'Ilhas F√©roe': '+298', 'Groenl√¢ndia': '+299', 'Gr√©cia': '+30', 'Pa√≠ses Baixos': '+31', 'B√©lgica': '+32', 'Fran√ßa': '+33', 'Espanha': '+34', 'Gibraltar': '+350', 'Portugal': '+351', 'Luxemburgo': '+352', 'Irlanda': '+353', 'Isl√¢ndia': '+354', 'Alb√¢nia': '+355', 'Malta': '+356', 'Chipre': '+357', 'Finl√¢ndia': '+358', 'Ilhas √Öland': '+358', 'Bulg√°ria': '+359', 'Hungria': '+36', 'Litu√¢nia': '+370', 'Let√¥nia': '+371', 'Est√¥nia': '+372', 'Mold√°via': '+373', 'Arm√™nia': '+374', 'Bielorr√∫ssia': '+375', 'Andorra': '+376', 'M√¥naco': '+377', 'San Marino': '+378', 'Vaticano': '+39', 'Ucr√¢nia': '+380', 'S√©rvia': '+381', 'Montenegro': '+382', 'Kosovo': '+383', 'Cro√°cia': '+385', 'Eslov√™nia': '+386', 'B√≥snia e Herzegovina': '+387', 'Maced√¥nia do Norte': '+389', 'It√°lia': '+39', 'Rom√™nia': '+40', 'Su√≠√ßa': '+41', 'Ch√©quia': '+420', 'Eslov√°quia': '+421', 'Listenstaine': '+423', '√Åustria': '+43', 'Reino Unido': '+44', 'Gu√©rnesei': '+44', 'Ilha de Man': '+44', 'J√©rsei': '+44', 'Dinamarca': '+45', 'Su√©cia': '+46', 'Noruega': '+47', 'Jan Mayen': '+47', 'Svalbard': '+47', 'Pol√¥nia': '+48', 'Alemanha': '+49', 'Belize': '+501', 'Guatemala': '+502', 'El Salvador': '+503', 'Honduras': '+504', 'Nicar√°gua': '+505', 'Costa Rica': '+506', 'Panam√°': '+507', 'S√£o Pedro e Miquel√£o': '+508', 'Haiti': '+509', 'Peru': '+51', 'M√©xico': '+52', 'Cuba': '+53', 'Argentina': '+54', 'Brasil': '+55', 'Chile': '+56', 'Col√¥mbia': '+57', 'Venezuela': '+58', 'Bol√≠via': '+591', 'Guiana': '+592', 'Equador': '+593', 'Guiana Francesa': '+594', 'Paraguai': '+595', 'Martinica': '+596', 'Suriname': '+597', 'Uruguai': '+598', 'Antilhas Holandesas': '+599', 'Mal√°sia': '+60', 'Austr√°lia': '+61', 'Ilha Christmas': '+61', 'Ilhas Cocos (Keeling)': '+61', 'Indon√©sia': '+62', 'Filipinas': '+63', 'Nova Zel√¢ndia': '+64', 'Ilhas Pitcairn': '+64', 'Singapura': '+65', 'Tail√¢ndia': '+66', 'Timor-Leste': '+670', 'Ant√°rtida': '+672', 'Ilha Norfolk': '+672', 'Brunei': '+673', 'Nauru': '+674', 'Papua-Nova Guin√©': '+675', 'Tonga': '+676', 'Ilhas Salom√£o': '+677', 'Vanuatu': '+678', 'Fiji': '+679', 'Palau': '+680', 'Wallis e Futuna': '+681', 'Ilhas Cook': '+682', 'Niue': '+683', 'Samoa': '+685', 'Quiribati': '+686', 'Nova Caled√¥nia': '+687', 'Tuvalu': '+688', 'Polin√©sia Francesa': '+689', 'Toquelau': '+690', 'Micron√©sia': '+691', 'Ilhas Marshall': '+692', 'R√∫ssia': '+7', 'Cazaquist√£o': '+7', 'Jap√£o': '+81', 'Coreia do Sul': '+82', 'Vietn√£': '+84', 'Coreia do Norte': '+850', 'Hong Kong': '+852', 'Macau': '+853', 'Camboja': '+855', 'Laos': '+856', 'China': '+86', 'Bangladesh': '+880', 'Taiwan': '+886', 'Turquia': '+90', 'Chipre do Norte': '+90', '√çndia': '+91', 'Paquist√£o': '+92', 'Afeganist√£o': '+93', 'Sri Lanka': '+94', 'Mianmar': '+95', 'Maldivas': '+960', 'L√≠bano': '+961', 'Jord√¢nia': '+962', 'S√≠ria': '+963', 'Iraque': '+964', 'Kuwait': '+965', 'Ar√°bia Saudita': '+966', 'I√™men': '+967', 'Om√£': '+968', 'Palestina': '+970', 'Emirados √Årabes Unidos': '+971', 'Israel': '+972', 'Bahrein': '+973', 'Catar': '+974', 'But√£o': '+975', 'Mong√≥lia': '+976', 'Nepal': '+977', 'Ir√£': '+98', 'Tajiquist√£o': '+992', 'Turcomenist√£o': '+993', 'Azerbaij√£o': '+994', 'Ge√≥rgia': '+995', 'Abec√°sia': '+995', 'Oss√©tia do Sul': '+995', 'Quirguist√£o': '+996', 'Uzbequist√£o': '+998'
    };
    
    // Adiciona as op√ß√µes de pa√≠ses ao campo de sele√ß√£o
    const paisSelect = document.getElementById('pais');
    for (const [pais, codigo] of Object.entries(paises).sort()) {
        const option = document.createElement('option');
        option.value = codigo;
        option.textContent = pais;
        paisSelect.appendChild(option);
    }

    const telefoneInput = document.getElementById('telefone');
    let phoneMask = null;

    // Mascaras de telefone
    const maskOptions = {
        'Brasil': { mask: '(00) 00 00000-0000', placeholder: '(+55) __ _____-____' },
        'Estados Unidos': { mask: '(0) 0 000 000-0000', placeholder: '(+1) ___ ___-____' },
        'Canad√°': { mask: '(0) 000 000-0000', placeholder: '(+1) ___ ___-____' },
        'Portugal': { mask: '(000) 000 000 000', placeholder: '(+351) ___ ___ ___' },
        'Fran√ßa': { mask: '(00) 0 00 00 00 00', placeholder: '(+33) _ __ __ __ __' },
        'Reino Unido': { mask: '(00) 00 0000 000000', placeholder: '(+44) ____ ___ ___' }
    };

    paisSelect.addEventListener('change', function() {
        const nomePais = this.options[this.selectedIndex].text;
        const codigo = this.value;
        
        // Atualiza a m√°scara de telefone
        if (phoneMask) {
            phoneMask.destroy();
        }
        if (nomePais && maskOptions[nomePais]) {
            telefoneInput.placeholder = maskOptions[nomePais].placeholder;
            phoneMask = IMask(telefoneInput, { mask: maskOptions[nomePais].mask, lazy: false });
        } else {
            telefoneInput.placeholder = 'Digite seu telefone';
            phoneMask = null;
        }
        
        if(nomePais === 'Brasil') {
            telefoneInput.value = '55';
        } else {
            telefoneInput.value = codigo;
        }

        // Altera dinamicamente o campo de estado
        const estadoWrapper = document.getElementById('estado-wrapper');
        const currentEstadoField = document.getElementById('estado');
        const icon = currentEstadoField.nextElementSibling; // Salva o √≠cone

        if (nomePais === 'Brasil') {
            if (currentEstadoField.tagName !== 'SELECT') {
                const select = document.createElement('select');
                select.id = 'estado';
                select.name = 'estado';
                select.required = true;

                const estados = ["Acre", "Alagoas", "Amap√°", "Amazonas", "Bahia", "Cear√°", "Distrito Federal", "Esp√≠rito Santo", "Goi√°s", "Maranh√£o", "Mato Grosso", "Mato Grosso do Sul", "Minas Gerais", "Par√°", "Para√≠ba", "Paran√°", "Pernambuco", "Piau√≠", "Rio de Janeiro", "Rio Grande do Norte", "Rio Grande do Sul", "Rond√¥nia", "Roraima", "Santa Catarina", "S√£o Paulo", "Sergipe", "Tocantins"];
                
                const defaultOption = document.createElement('option');
                defaultOption.value = "";
                defaultOption.textContent = "Selecione seu estado";
                select.appendChild(defaultOption);

                estados.sort().forEach(estado => {
                    const option = document.createElement('option');
                    option.value = estado;
                    option.textContent = estado;
                    select.appendChild(option);
                });
                
                estadoWrapper.innerHTML = ''; // Limpa o wrapper
                estadoWrapper.appendChild(select);
                if (icon) estadoWrapper.appendChild(icon); // Re-adiciona o √≠cone
            }
        } else {
            if (currentEstadoField.tagName !== 'INPUT') {
                const input = document.createElement('input');
                input.type = 'text';
                input.id = 'estado';
                input.name = 'estado';
                input.required = true;
                
                estadoWrapper.innerHTML = ''; // Limpa o wrapper
                estadoWrapper.appendChild(input);
                if (icon) estadoWrapper.appendChild(icon); // Re-adiciona o √≠cone
            }
        }
    });

    function loadConfig() {
        fetch(appScriptURL)
            .then(response => response.json())
            .then(config => {
                document.getElementById('pageTitle').textContent = config.title;
                document.getElementById('formTitle').textContent = config.title;
                const observacaoElement = document.getElementById('observacao');
                observacaoElement.innerHTML = config.observacao;
                const headerImageElement = document.getElementById('headerImage');
                if (config.imageUrl) {
                    headerImageElement.src = config.imageUrl;
                    headerImageElement.style.display = 'block';
                } else {
                    headerImageElement.style.display = 'none';
                }
            })
            .catch(error => {
                console.error('Erro ao carregar as configura√ß√µes:', error);
                document.getElementById('formTitle').textContent = 'Erro ao carregar o formul√°rio.';
            });
    }

    window.onload = loadConfig;

    document.getElementById('cadastroForm').addEventListener('submit', function(event) {
        event.preventDefault();

        // Validar campos obrigat√≥rios
        const nome = document.getElementById('nome').value;
        const email = document.getElementById('email').value;
        const estado = document.getElementById('estado').value;
        const cidade = document.getElementById('cidade').value;
        const pais = paisSelect.value;
        const telefone = telefoneInput.value;
        const consentimento = document.querySelector('input[name="consentimento"]:checked');
        const consagracao = document.querySelector('input[name="anoConsagracao"]:checked');

        if (!nome || !email || !estado || !cidade || !pais || !telefone || !consentimento || !consagracao) {
            alert('Por favor, preencha todos os campos obrigat√≥rios.');
            return;
        }

        // Valida√ß√£o do Telefone
        const paisSelecionado = paisSelect.options[paisSelect.selectedIndex].text;
        const telefoneLimpo = telefone.replace(/\D/g, '');
        const codigoLimpo = pais.replace(/\D/g, '');

        if (paisSelecionado === 'Brasil') {
            if (telefoneLimpo.length < 12 || telefoneLimpo.length > 13) { // 55 11 987654321
                alert('O n√∫mero de telefone brasileiro deve ter 12 ou 13 d√≠gitos (Ex: 5511987654321).');
                return;
            }
        } else {
            if (telefoneLimpo.length <= codigoLimpo.length) {
                alert('Por favor, insira seu n√∫mero de telefone completo ap√≥s o c√≥digo do pa√≠s.');
                return;
            }
        }
        document.getElementById('telefoneValidation').style.display = 'none';

        const data = new URLSearchParams();
        data.append('nome', nome);
        data.append('email', email);
        data.append('pais', paisSelecionado);
        data.append('estado', estado);
        data.append('cidade', cidade);
        data.append('telefone', telefone);
        data.append('anoConsagracao', consagracao.value);
        data.append('consentimento', consentimento.value);

        const loadingText = document.getElementById('loading');
        loadingText.style.display = 'block';

        fetch(appScriptURL, {
            method: 'POST',
            body: data
        })
        .then(response => response.json())
        .then(result => {
            if (result.result === 'success') {
                // Redireciona diretamente para o link do WhatsApp
                window.location.href = result.whatsappLink;
            } else {
                loadingText.textContent = 'Erro ao enviar dados. Tente novamente.';
                loadingText.style.color = 'red';
            }
        })
        .catch(error => {
            loadingText.textContent = 'Erro de conex√£o. Tente novamente.';
            loadingText.style.color = 'red';
        });
    });
</script>
</body>
</html>
